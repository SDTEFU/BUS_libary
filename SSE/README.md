
# Streamline-Scala-Module (SSM) 总线/通讯协议
> ##### 此总线之可以有一个主设备一个中断控制器多个从设备
> ##### 主设备由SSE控制器选择
> ##### 通讯时数据位宽为 W = 2^(3+n) bit且(n>=0)
> ##### 总线上所有信号的默认值都为0复位值为0

> ### 总线体系
>> SSE控制器由组合逻辑组成
>>>SSE控制器用来仲裁选择对总线控制的主设备
> 
>![总线体系](./SSE%E6%80%BB%E7%BA%BF%E4%BD%93%E7%B3%BB.svg)

> ### SSE控制器信号
|输入/输出 | 位宽(bits)  |信号名      | 说明 
|:---:    | :----:     | :----:    |:----:  
| in      | 1          | use       | 请求变成主设备
| out     | 1          | belong    | 正在控制总线 

> 总线信号

| 位宽(bits)  |信号名      | 说明 
| :----:      | :----:   |:----:  
| 1           | clk      |主设备发出的时钟信号
| 1           | rst      |主设备发出的复位信号
| w           | addr     |设备地址
| w           | rw_data  |读写的数据
| 1           | acces    |请求执行标志
| 1           | w_en     |写使能标志 
| 1           | done     |完成执行标志
| 1           | int      |中断信号
| 1           | int_en   |中断使能标志

> **master**          

|输入/输出| 位宽(bits)   |信号名      | 说明          
|:---:   | :----:      | :----:    |:----:   
|out     | w           | m_addr    |主设备要访问的从设备地址
|inout   | w           | m_rw_data |主设备读写的数据
|out     | 1           | m_acces   |主设备请求从设备执行标志
|out     | 1           | m_w_en    |主设备写使能标志 
|in      | 1           | m_done    |主设备接收从设备完成执行标志
|in      | 1           | int       |中断信号
|out     | 1           | int_en    |中断使能标志
> **slave**
 
|输入/输出| 位宽(bits)   |信号名      | 说明          
|:---:   | :----:      |:----:     | :----:        
|in      | w           | s_addr    |从设备地址
|inout   | w           | s_rw_data |从设备读写的数据
|in      | 1           | s_acces   |从被需要执行标志
|in      | 1           | s_w_en    |从设备被写使能标志 
|out     | 1           | s_done    |从设备完成执行标志
|in      | 1           | int       |中断信号
|in      | 1           | int_en    |中断使能标志
> **中断控制器**

|输入/输出| 位宽(bits)   |信号名      | 说明          
|:---:   | :----:      |:----:     | :----:  
|out     | w           | i_rw_data |中断状态码  
|out     | 1           | int       |中断信号
|in      | 1           | int_en    |中断使能标志
> 标志信号说明

|标志信号                 |  说明  
|:---:                  |  :----:
|主设备请求从设备执行标志   |主设备请求外设执行需求操作标志
|主设备写使能标志          |为1时表示向外设写数据/为0时表示向外设读数据
|从设备完成执行标志        |从设备完成把数据写到总线/完成从总线读数据
|中断使能标志             |保持1时表示使能中断控制器，若为0则失能中断控制器

> 标志信号流动方向
```RUST
主设备请求从设备执行标志  ->    从被需要执行标志
主设备写使能标志         ->    从设备被写使能标志 
从设备完成执行标志       ->    主设备接收从设备完成执行标志 
```


> ## 通讯过程
>> ### 主设备读数据
>>> 1. 主设备把要读数据的外设地址发送到m_addr保持一个时钟周期且m_rw置0
>>> 2. m_acces产生一个时钟周期的脉冲
>>> 3. 从设备会把数据发送到s_write
>>> 4. 读数据完成后从设备s_done产生一个时钟周期的脉冲，完成读数据
>> ### 主设备写数据
>>> 1. 主设备把要写数据的外设地址发送到m_addr，要写的数据发送到m_rw_data上，且m_rw置1，都保持一个时钟周期
>>> 2. m_acces产生一个时钟周期的脉冲
>>> 3. 从设备会通过s_read读到要写的数据
>>> 4. 写数据完成后从设备s_done产生一个时钟周期的脉冲，完成写数据
>> ### 中断过程
>>> 中断控制器产生中断时若int_en为1，则置int为1将中断标签发送到rw_data上，都保持一个时钟周期
>>> 中断来临时各主从设备应该由组合逻辑将对总线的信号改为0
>>> 主设备接收到中断执行中断